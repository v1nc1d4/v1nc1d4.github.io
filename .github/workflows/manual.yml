name: Deploy Tor Hidden Service (Static Site)

on:
  push:
    branches:
      - main # or your main branch name

jobs:
  deploy:
    runs-on: ubuntu-latest # or your preferred runner

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v3

    - name: Install Tor
      run: |
        sudo apt-get update
        sudo apt-get install tor -y

    - name: Create Tor Directory
      run: mkdir tor
    
    - name: Enter Tor Directory
      run: cd tor
    
    - name: Clone GitHub Repository
      run: git clone https://github.com/anuragmuxui/anuragmuxui.github.io.git

    - name: Configure Tor
      run: |
        sudo sed -i 's/#HiddenServiceDir \/var\/lib\/tor\/hidden_service\//HiddenServiceDir \/var\/lib\/tor\/hidden_service\//' /etc/tor/torrc
        sudo sed -i 's/#HiddenServicePort 80 127.0.0.1:80/HiddenServicePort 80 127.0.0.1:80/' /etc/tor/torrc
        echo "HiddenServiceVersion 3" >> /etc/tor/torrc
        echo "HiddenServiceDir /var/lib/tor/hidden_service" >> /etc/tor/torrc
        echo "HiddenServicePort 80 127.0.0.1:80" >> /etc/tor/torrc
        sudo systemctl restart tor

    - name: Wait for Tor Service to Start
      run: sleep 30  # Wait for 30 seconds to make sure service is up

    - name: Get Onion Address
      run: |
          sudo cat /var/lib/tor/hidden_service/hostname

    - name: Delay to keep server running
      run: |
        sleep 3600 # keep the server running for 1 hour, you can adjust as necessary
